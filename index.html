<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="style.css">
    <title>Mac</title>
</head>
<body>
    <div class="toolbar">
        <div class="l">
            <div><div class="top-time"></div></div>
        </div>
        <div class="c">
            <div class="btn-new-bx" onclick="newBox()">
                <i class="fa-solid fa-plus add-bx-icon"></i>
            </div>
        </div>
        <div class="r">
            <!-- <i class="fa-solid fa-gear"></i> -->
            <div>set</div>
        </div>
    </div>
    <main id="main">
        <div class="bx" id="1234567890" data-group="1234567890" style="z-index: 10;" onfocus="bxToTop()">
            <input type="checkbox" id="bx-12-door" class="bx-set-door dpnone">
            <input type="checkbox" id="input-onoff-link-id" class="dpnone">
            <section class="bx-set">
                <div class="bx-set-main">
                    <div class="bx-set-title">
                        <div class="title">제목 <input type="checkbox" id="input-onoff-title-id" class=""></div>
                        
                    </div>
                    <div class="bx-set-c">
                        <div class="title">색상</div>
                    </div>
                    <div class="bx-set-ㄹ">
                        <div class="title">글자</div>
                    </div>
                    <div class="bx-set-apps">
                        <div class="title">앱 목록</div>
                        <label for="input-onoff-link-id">
                            <label class="tgl-btn" for="input-onoff-link-id">link<input type="checkbox" id="input-onoff-link-id" class=""></label>
                            
                        </label>
                        <label for="input-onoff-task-id">
                            <label class="tgl-btn" for="input-onoff-task-id">task<input type="checkbox" id="input-onoff-task-id" class=""></label>
                            
                        </label>
                        <label for="input-onoff-text-id">
                            <label class="tgl-btn" for="input-onoff-text-id">text<input type="checkbox" id="input-onoff-text-id" class=""></label>
                            
                        </label>
                    </div>
                </div>
            </section>
            <section class="bx-ctrl">
                <button class="tool bx-x" onclick=""></button>
                <button class="tool bx-m"></button>
                <button class="tool bx-f" onclick="bxF()"></button>
            </section>
            <section class="bx-main">
                <div class="bx-hdr" id="hi" data-group="1234567890">
                    <div class="c">
                        <label for="title-123" class="bx-title">test</label>
                        <input type="text" class="bx-title-input dpnone" id="title-123" value="hi">
                    </div>

                    <label for="bx-12-door"  class="r">
                        <i class="fa-solid fa-ellipsis-vertical"></i>
                    </label>
                </div>
                <div class="bx-apps"></div>
            </section>
        </div>

    </main>

    <footer>

    </footer>
    <script src="toolbar.js"></script>
    <script src="box.js"></script>
    <script>
    let isDragging = false;
    let draggingbx = null;
    let touchStartTime = 0;
    let offsetX, offsetY;
    let maxXPercent, maxYPercent;
    
    let headers =document.querySelectorAll('.bx-hdr');

    headers.forEach(h => {
        h.addEventListener('mousedown', handleStart);
        h.addEventListener('touchstart', handleStart);
    })
        //박스 클릭 최상단
    let bxZindexArr = [];

    console.log(bxZindexArr);
    function toTopBox() {
        const ID = event.target.dataset.group;
        const z = document.getElementById(ID).style.zIndex;
        console.log(ID);
        console.log(z);
    }

    function handleStart(e) {
        if (isDragging) return;
        
        toTopBox(e);

        touchStartTime = new Date().getTime();
        const touch = e.type === 'touchstart' ? e.touches[0] : e;
    
        setTimeout(() => {
            const currentTime = new Date().getTime();
            if (isDragging || (currentTime - touchStartTime < 200)) {
                return;
            }

            const ID = e.target.dataset.group;
            draggingbx = document.getElementById(ID);
            
            offsetX = touch.clientX - draggingbx.getBoundingClientRect().left;
            offsetY = touch.clientY - draggingbx.getBoundingClientRect().top;
            
            const zi = draggingbx.style.zIndex;
            // console.log(zi);
            document.body.style.cursor = 'grabbing';
            draggingbx.style.webkitUserSelect = 'none';
            draggingbx.style.transform = 'scale(1.02)';
        
            const startXPercent = (touch.clientX - offsetX) / window.innerWidth * 100;
            const startYPercent = (touch.clientY - offsetY) / window.innerHeight * 100;
    
            draggingbx.style.left = `${startXPercent}%`;
            draggingbx.style.top = `${startYPercent}%`;
        
            maxXPercent = 100 - (draggingbx.offsetWidth / window.innerWidth * 100);
            maxYPercent = 100 - (draggingbx.offsetHeight / window.innerHeight * 100);
        
            document.addEventListener('mousemove', moveHandler);
            document.addEventListener('touchmove', moveHandler);
        
            document.addEventListener('mouseup', () => {
                endDrag();
            });
            document.addEventListener('touchend', () => {
                endDrag();
            });

            function moveHandler(e) {
                const touch = e.type === 'touchmove' ? e.touches[0] : e;
                let xPercent = (touch.clientX - offsetX) / window.innerWidth * 100;
                let yPercent = (touch.clientY - offsetY) / window.innerHeight * 100;
        
                xPercent = Math.min(maxXPercent, Math.max(0, xPercent));
                yPercent = Math.min(maxYPercent, Math.max(0, yPercent));
        
                draggingbx.style.left = `${xPercent}%`;
                draggingbx.style.top = `${yPercent}%`;
            }
        
            function endDrag() {
                if (draggingbx) {
                document.body.style.cursor = 'auto';
                draggingbx.style.webkitUserSelect = '';
                draggingbx.style.transform = 'scale(1)';
        
                document.removeEventListener('mousemove', moveHandler);
                document.removeEventListener('touchmove', moveHandler);
                draggingbx = null;
                isDragging = false;
                }
            }
        
            isDragging = true;
        }, 200);
    }

//박스 좌측 상단 버튼
    //최대화

    function bxF(){
        const ID = event.target.parentElement.parentElement.dataset.group;
        const bx = document.getElementById(ID);
        bx.style.top = '0';
        bx.style.left = '0';
        bx.style.width = '100%';
        bx.style.height = '100%';
        bx.style.transition = 'all .5s ease-in-out';
    };

const bxs = document.querySelectorAll('.bx');

const observer = new ResizeObserver((bx) => {
  bx.forEach((bx) => {
    const bxSet = document.getElementById(bx.target.id).querySelector('.bx-set');

    const w = bx.contentRect.width;
    // if(w < 200){
        
    // }
    console.log(Math.floor(bx.contentRect.width) + '*' + Math.floor(bx.contentRect.height));
  });
});

// 크기변화를 관찰할 요소지정
bxs.forEach(bx => observer.observe(bx));

    </script>
      
    
    
    <script src="https://kit.fontawesome.com/e4704dcbbd.js" crossorigin="anonymous"></script>
</body>
</html>