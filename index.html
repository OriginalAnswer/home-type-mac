<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="style.css">
    <title>Mac</title>
</head>
<body>
    <main>
        <div class="app box" id="012789473098" data-group="012789473098" style="z-index: 10;">
            <div class="boxheader" id="hi" data-group="012789473098">
                <div class="l">
                    <button class="tool x"></button>
                    <button class="tool m"></button>
                    <button class="tool f"></button>
                </div>
                <div class="c">
                    <input type="text" class="app-title" value="hi">
                </div>
                <div class="r">
                    <button class="more">
                        <i class="fa-solid fa-ellipsis-vertical"></i>
                    </button>
                </div>
            </div>
        </div>
        <div class="app box" id="12" data-group="12" style="z-index: 10;">
            <div class="boxheader" id="hi" data-group="12">
                <div class="l">
                    <button class="tool x"></button>
                    <button class="tool m"></button>
                    <button class="tool f"></button>
                </div>
                <div class="c">
                    <input type="text" class="app-title" value="hi">
                </div>
                <div class="r">
                    <button class="more">
                        <i class="fa-solid fa-ellipsis-vertical"></i>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script>
    let isDragging = false;
    let draggingBox = null;
    let touchStartTime = 0;
    let offsetX, offsetY;
    let maxXPercent, maxYPercent;
    
    // const header = document.querySelector('.boxheader');
    let headers =document.querySelectorAll('.boxheader');

    headers.forEach(h => {
        h.addEventListener('mousedown', handleStart);
        h.addEventListener('touchstart', handleStart);
    })
    let arr = [];
    console.log(arr);
    headers.forEach(h => {
        const ID = h.dataset.group;
        const app = document.getElementById(ID);
        const z = app.style.zIndex;
        console.log(ID);
        console.log(app);
        console.log(z);
        arr.push(z);
    })
    console.log(arr);
    
    // header.addEventListener('mousedown', handleStart);
    // header.addEventListener('touchstart', handleStart);

    function handleStart(e) {
        if (isDragging) return;
    
        touchStartTime = new Date().getTime();
        const touch = e.type === 'touchstart' ? e.touches[0] : e;
    
        setTimeout(() => {
        const currentTime = new Date().getTime();
        if (isDragging || (currentTime - touchStartTime < 1000)) {
            return;
        }

        const ID = e.target.dataset.group;
        draggingBox = document.getElementById(ID);
        
        offsetX = touch.clientX - draggingBox.getBoundingClientRect().left;
        offsetY = touch.clientY - draggingBox.getBoundingClientRect().top;
        
        const zi = draggingBox.style.zIndex;
        console.log(zi);
        document.body.style.cursor = 'grabbing';
        draggingBox.style.webkitUserSelect = 'none';
        draggingBox.style.transform = 'scale(1.05)';
        draggingBox.style.zIndex = `${zi + 2}`;
    
        const startXPercent = (touch.clientX - offsetX) / window.innerWidth * 100;
        const startYPercent = (touch.clientY - offsetY) / window.innerHeight * 100;
    
        draggingBox.style.left = `${startXPercent}%`;
        draggingBox.style.top = `${startYPercent}%`;
    
        maxXPercent = 100 - (draggingBox.offsetWidth / window.innerWidth * 100);
        maxYPercent = 100 - (draggingBox.offsetHeight / window.innerHeight * 100);
    
        document.addEventListener('mousemove', moveHandler);
        document.addEventListener('touchmove', moveHandler);
    
        document.addEventListener('mouseup', () => {
            endDrag();
        });
        document.addEventListener('touchend', () => {
            endDrag();
        });
    
        function moveHandler(e) {
            const touch = e.type === 'touchmove' ? e.touches[0] : e;
            let xPercent = (touch.clientX - offsetX) / window.innerWidth * 100;
            let yPercent = (touch.clientY - offsetY) / window.innerHeight * 100;
    
            xPercent = Math.min(maxXPercent, Math.max(0, xPercent));
            yPercent = Math.min(maxYPercent, Math.max(0, yPercent));
    
            draggingBox.style.left = `${xPercent}%`;
            draggingBox.style.top = `${yPercent}%`;
        }
    
        function endDrag() {
            if (draggingBox) {
            document.body.style.cursor = 'auto';
            draggingBox.style.webkitUserSelect = '';
            draggingBox.style.transform = 'scale(1)';
    
            document.removeEventListener('mousemove', moveHandler);
            document.removeEventListener('touchmove', moveHandler);
            draggingBox = null;
            isDragging = false;
            }
        }
    
        isDragging = true;
        }, 1000);
    }
    </script>
      
    
    
    <script src="https://kit.fontawesome.com/e4704dcbbd.js" crossorigin="anonymous"></script>
</body>
</html>